import os
import threading
import time
import random
import requests
from telegram import Bot
from dotenv import load_dotenv

load_dotenv()
BOT_TOKEN = os.getenv("BOT_TOKEN")
CHANNEL_ID = os.getenv("CHANNEL_ID")

bot = Bot(token=BOT_TOKEN)

SIGNATURES = [
    "🚂 Электричка — философия в движении",
    "⚡ Мысли на рельсах",
    "🌌 Мимо станции — прямо в сознание",
    "📡 Подключайся к потоку идей",
    "🎭 Между строк и шпал",
    "☕ Утренний поезд вдохновения",
    "🪞Отражения между станциями",
    "💡 Свет на перегоне мыслей",
    "🕰️ Всё повторяется, кроме мгновений",
    "🪶 Лёгкий ветер идей на путях",
    "📖 Станция Смысла. Следующая остановка — Вы",
    "🧩 Каждый день — новая ветка маршрута",
    "🚦Не стой на месте, пока горит зелёный",
    "🎧 Слушай тишину между цитатами",
    "🚉 Электричка — туда, где ждут слова",
    "💭 Мысли мимоходом",
    "🌙 Ночь — лучшее время для идей",
    "🔥 Искра мысли — и мир освещён",
    "🛤️ На стыке шпал рождаются идеи",
    "🍃 Просто дыши, поезд всё равно идёт",
    "🌤️ День начинается с цитаты",
    "🕊️ Вдохновение без расписания",
    "🚆 Прислушайся — это мысль едет",
    "📜 Мудрость без пересадок",
    "🧠 Разгоняем мышление по рельсам",
    "💫 Каждая цитата — станция осознания",
    "🌇 Вечерняя электричка размышлений",
    "🎬 Мгновение перед откровением",
    "🌍 Мы едем не куда-то, а зачем-то",
    "📘 Между шпалами — страницы жизни",
    "🌲 Природа идей вечнозелена",
    "⚙️ Механизм вдохновения запущен",
    "💎 Мысли — редкие камни пути",
    "🧭 Поворот за поворотом — к себе",
    "📡 Лови частоту смыслов",
    "🎨 Краски пути в каждом слове",
    "💤 Иногда электричка спит. Но не сегодня.",
    "🕊️ Движение — форма размышления",
    "🎢 Мысли — как вагоны: соединены логикой",
    "🌞 Новое утро — новый маршрут",
    "🪐 Космос внутри рельсов",
    "🍂 Осень — сезон цитат и вдохновения",
    "🏙️ Город проносится, смысл остаётся",
    "🔮 Иногда будущее звучит как цитата",
    "🎡 Мысли вращаются, но остаются круглыми",
    "🪶 Каждое слово — перо на ветру",
    "🎺 Музыка цитат в вагоне №22",
    "🕰️ Между прошлым и будущим — мы",
    "🌉 Переправа мыслей на другой берег",
    "🚦Пока поезд стоит — думай",
    "📷 Кадр вдохновения: здесь и сейчас",
    "🎁 Идея — лучший подарок себе",
    "🧩 Мысли сходятся в одной точке",
    "🛸 Миссия: размышление завершено успешно",
    "🌄 Доброе утро, путешественник мысли",
    "💬 Каждая цитата — как попутчик",
    "🎐 Пусть ветер несёт слова дальше",
    "🌙 Ночь — лучший собеседник философа",
    "🚂 Вдохновение не опаздывает",
    "🧠 Твоя мысль — твоя станция",
    "⚡ Электричка идей снова в пути",
    "🌺 Цитаты — цветы пути",
    "🎭 Каждый день — театр электрички",
    "🧭 Главное — не направление, а осознание",
    "📜 Линия судьбы проходит по шпалам",
    "🔔 Следующая остановка — вдохновение",
    "🌈 Смысл всегда где-то рядом",
    "📻 Радио мыслей работает без пауз",
    "🌊 Поток идей не остановить",
    "📘 Всё написано — но не всё понято",
    "🚧 Ремонт смысла временно завершён",
    "🕳️ Глубже — там, где молчание",
    "🪞 В зеркале окна — твоё отражение",
    "🌤️ Солнечная цитата для пасмурного дня",
    "📡 Сигнал из вселенной принят",
    "🎬 Конец сцены. Но не смысла.",
    "📓 Новая страница пути открыта",
    "🌻 Цитата дня: будь собой, даже на шпалах",
    "🕰️ Время — самый точный философ",
    "🌌 Космос цитат бесконечен",
    "🪄 Магия — это мысль, вовремя сказанная",
    "🎐 Пусть день пройдёт с лёгкой мыслью",
    "🚇 Мысли под землёй — всё ещё светлые",
    "🌲 Где-то в тишине растёт идея",
    "🧩 Смысл складывается по кусочкам",
    "🕊️ Каждый день — отправление в неизвестность",
    "🌉 Станция 'Осознанность' — конечная",
    "📡 Электричка ловит волну вдохновения",
    "🚆 Следующий рейс — к самому себе",
    "💭 Пусть поезд не останавливается",
    "🕯️ Тихая цитата для шумного дня",
    "🎠 Мысли кружатся, пока есть дорога",
    "🌇 Свет заката — лучшая метафора",
    "🧭 Туда, где ждёт новое понимание",
    "🎇 Искра идей на перегоне души",
    "🌙 Электричка мечтаний тронулась",
    "📘 Сегодня без пересадок — прямо в смысл",
    "🚉 Конец линии — только начало нового пути",
    "✨ Электричка едет. Мысли продолжаются."
]

def get_quote():
    try:
        response = requests.get("https://zenquotes.io/api/random")
        data = response.json()[0]
        quote = f"«{data['q']}» — {data['a']}"
        signature = random.choice(SIGNATURES)
        return f"{quote}\n\n{signature}"
    except Exception:
        return "⚠️ Ошибка загрузки цитаты. Попробуем позже."

def keep_alive():
    url = os.getenv("RENDER_EXTERNAL_URL")
    if not url:
        return
    while True:
        try:
            requests.get(url)
        except Exception:
            pass
        time.sleep(600)

def autopost():
    while True:
        quote = get_quote()
        try:
            bot.send_message(chat_id=CHANNEL_ID, text=quote)
        except Exception as e:
            print("Ошибка отправки:", e)
        time.sleep(3 * 60 * 60)

threading.Thread(target=keep_alive, daemon=True).start()
threading.Thread(target=autopost, daemon=True).start()

print("🚆 Электричка запущена и едет по расписанию!")

while True:
    time.sleep(60)
