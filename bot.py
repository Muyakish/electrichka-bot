import os
import requests
import threading
import time
import random
from telegram import Bot
from dotenv import load_dotenv

# Загрузка токена и ID канала из .env
load_dotenv()
TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
CHANNEL_ID = os.getenv("TELEGRAM_CHANNEL_ID")
bot = Bot(token=TOKEN)

# --- KEEP ALIVE ДЛЯ РЕНДЕРА ---
def keep_alive():
    url = os.getenv("RENDER_EXTERNAL_URL")
    if not url:
        return
    while True:
        try:
            requests.get(url)
        except Exception:
            pass
        time.sleep(600)  # пинг каждые 10 минут

threading.Thread(target=keep_alive, daemon=True).start()


# --- СПИСОК 100 АВТОПОДПИСЕЙ ---
CAPTIONS = [
    "🚄 Электричка — слова с привкусом смысла",
    "💭 Подумай об этом. Электричка рядом.",
    "🕊 Спокойствие приходит с первой строчкой",
    "🎧 В каждом звуке есть мысль. Электричка.",
    "🌫 Слушай тишину между словами",
    "🪞 Иногда отражение честнее оригинала",
    "🌌 Вселенная молчит, но Электричка говорит",
    "🛤 Мысли движутся быстрее рельс",
    "☕ Утро начинается с философии",
    "💬 Цитата дня от Электрички",
    "📜 Старые слова в новом вагоне",
    "🚆 Твоя станция — осознанность",
    "🌙 Даже ночью мысли не спят",
    "🔥 Иногда искра — уже пожар",
    "🧩 Мысль без смысла — это пауза",
    "⚙️ Простая механика сложных чувств",
    "🕰 Настоящее — это только сейчас",
    "🧘‍♂️ Молчание — тоже ответ",
    "🪶 Легко — не значит пусто",
    "🎭 Электричка — театр одной мысли",
    "📖 Новая глава без начала и конца",
    "💫 Мысли без адреса",
    "🚉 Каждая остановка — новая мысль",
    "🌧 Иногда дождь — это просто фон",
    "🍂 Улыбнись случайности",
    "🧠 Мы думаем, значит — живём",
    "🎢 Мысли бегут по рельсам сознания",
    "🌕 Луна наблюдает за текстами",
    "🎈 Случайность — вторая форма мудрости",
    "🕳 Внутри — больше, чем снаружи",
    "🚲 Движение — это тоже ответ",
    "🗝 Мысль — ключ, но замка нет",
    "💡 Простая идея — сложное чувство",
    "📡 Электричка на волне твоего настроения",
    "📷 Снимок тишины",
    "🎇 Искра разума между строк",
    "💭 Каждая цитата — зеркало",
    "🧭 Вектор без координат",
    "🛋 Отдохни на остановке мыслей",
    "📌 Напомни себе потом — сейчас",
    "🧃 Вдохни немного смысла",
    "🎲 Случайность — наш редактор",
    "📀 Прокрути день как кассету",
    "📡 Электричка передаёт привет сознанию",
    "🕊 Мысли не требуют разрешения",
    "⚡ Коротко, но метко",
    "🫧 Пузыри мыслей в потоке дня",
    "🎯 Цель — просто быть",
    "🎶 Каждое слово звучит внутри",
    "🎥 Жизнь — это цитата без автора",
    "📬 Подписано: Электричка",
    "🌊 Поток мыслей не остановить",
    "🚏 Остановка: вдохновение",
    "🛤 Рельсы сознания проложены дальше",
    "🕰 Электричка приходит вовремя",
    "🌤 Всё пройдёт — даже эта мысль",
    "🧩 Идеально несовершенно",
    "🍃 Мягко, как ветер между строк",
    "📖 Вечная цитата о временном",
    "🪞 Всё начинается с отражения",
    "🚪 Открой дверь, а там — мысль",
    "🌙 Электричка в ночи не спит",
    "💬 Вопрос без ответа — лучший ответ",
    "🧠 Простая идея — как сложная схема",
    "🕯 Свет фразы в темноте ленты",
    "🌌 Где-то между философией и юмором",
    "📡 Электричка ловит сигнал вдохновения",
    "🔑 Иногда мысль — просто ключ к паузе",
    "🪄 Миг, пойманный между словами",
    "🎢 Ирония движется быстрее смысла",
    "🌤 Мысль вышла покурить",
    "🫀 Сарказм с оттенком доброты",
    "🕳 Пустота — форма глубины",
    "🎭 Серьёзно о несерьёзном",
    "💬 Электричка. Коротко. Ясно. В точку.",
    "🌻 Доброе утро, философ!",
    "🌙 Доброй ночи, мыслитель.",
    "📡 Электричка в эфире 24/7",
    "🎢 Поезд эмоций без тормозов",
    "🌫 Утренняя дымка с мыслью внутри",
    "🧠 Нейроирония на максималках",
    "🎲 Рандомное просветление",
    "🧩 Всё совпадает, если не вглядываться",
    "🕰 Мгновение с послевкусием смысла",
    "🚆 Едем дальше — слов ещё много",
    "🎇 Искры фраз в темноте дня",
    "🧘 Мысленно где-то между пунктом А и Б",
    "📜 Минимализм мыслей",
    "🎧 Цитата звучит лучше, чем кажется",
    "💡 Фраза, которая могла бы стать книгой",
    "🛤 Электричка не останавливается",
    "📍 Следующая станция — ирония",
    "🌌 Электричка на связи. Молча.",
    "🎭 Один пост — сто смыслов",
    "🚄 Философия со скоростью света",
    "💭 Просто Электричка. Просто мысль.",
    "🕯 На грани сарказма и мудрости",
    "📡 Эфир продолжается...",
    "📖 Слова. Тишина. И снова слова.",
    "🪞 Ты в отражении этой цитаты?",
    "🎬 Продолжение следует...",
]


# --- ЦИТАТЫ + ИЗОБРАЖЕНИЯ ---
def get_quote():
    try:
        r = requests.get("https://zenquotes.io/api/random")
        data = r.json()[0]
        return f"{data['q']} — {data['a']}"
    except Exception:
        return "🚄 Электричка: тишина тоже говорит."

def get_image_url():
    return f"https://picsum.photos/seed/{random.randint(1,10000)}/800/600"


# --- АВТОПОСТ КАЖДЫЕ 3 ЧАСА ---
def auto_post():
    while True:
        quote = get_quote()
        image_url = get_image_url()
        signature = random.choice(CAPTIONS)
        caption = f"{quote}\n\n{signature}"
        try:
            bot.send_photo(chat_id=CHANNEL_ID, photo=image_url, caption=caption)
            print(f"[OK] Отправлено: {quote[:60]}...")
        except Exception as e:
            print(f"[Ошибка отправки] {e}")
        time.sleep(3 * 60 * 60)  # каждые 3 часа


# --- ЗАПУСК ---
if __name__ == "__main__":
    print("🚄 Электричка в пути — автопостинг каждые 3 часа...")
    auto_post()
