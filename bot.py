import os
import time
import requests
import random
from io import BytesIO
from threading import Thread
from flask import Flask, request, jsonify
from PIL import Image
from deep_translator import GoogleTranslator
import schedule

# ------------------- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ -------------------
TELEGRAM_BOT_TOKEN = os.getenv("ELECTRICHKA_BOT_TOKEN")
TELEGRAM_CHAT_ID = os.getenv("ELECTRICHKA_CHANNEL_ID")
ADMIN_CHAT_ID = os.getenv("ADMIN_CHAT_ID")  # –¢–≤–æ–π Telegram ID

if not TELEGRAM_BOT_TOKEN or not TELEGRAM_CHAT_ID:
    print("[CRITICAL] ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: ELECTRICHKA_BOT_TOKEN –∏–ª–∏ ELECTRICHKA_CHANNEL_ID", flush=True)
    exit(1)

# –°–ø–∏—Å–æ–∫ —Ñ–∏—Ä–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π
FIRMA_SIGNATURES = [
    "üöÜ –≠–ª–µ–∫—Ç—Ä–∏—á–∫–∞ —É–∂–µ —Ç—Ä–æ–Ω—É–ª–∞—Å—å ‚Äî –ø—Ä—ã–≥–∞–π –≤ –ø–æ—Ç–æ–∫ –∏–¥–µ–π!",
    "üåø –î–∞–∂–µ —Ä–æ–∑–µ—Ç–∫–∞ —É—Å—Ç–∞–ª–∞, –∞ —Ç—ã –≤—Å—ë –µ—â—ë –∑–∞—Ä—è–∂–∞–µ—à—å –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ.",
    "üí° –ò–Ω–æ–≥–¥–∞ —Å–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–µ –≤ –∫–æ–º–Ω–∞—Ç–µ, –∞ –≤ –≥–æ–ª–æ–≤–µ.",
    "üî• –ò—Å–∫—Ä–∞ –≤–Ω—É—Ç—Ä–∏ –≤–∞–∂–Ω–µ–µ –º–æ–ª–Ω–∏–∏ —Å–Ω–∞—Ä—É–∂–∏.",
    "üåô –ü–æ–∫–æ–π –ø—Ä–∏—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ—Å—Ç–∞—ë—à—å –∏—Å–∫–∞—Ç—å —Ä–æ–∑–µ—Ç–∫—É.",
    "‚òï –ú–æ–∑–≥ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏, –¥—É—à–∞ ‚Äî –ø–æ–¥–∑–∞—Ä—è–¥–∫–∏.",
    "üé≠ –ñ–∏–∑–Ω—å ‚Äî —Ç–µ–∞—Ç—Ä, –∞ —è –ø–∞—Å—Å–∞–∂–∏—Ä –±–µ–∑ –±–∏–ª–µ—Ç–∞.",
    "üê¢ –ù–µ —Å–ø–µ—à–∏, –ø–æ–µ–∑–¥ –∏–¥–µ–π –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —É–π–¥—ë—Ç –±–µ–∑ —Ç–µ–±—è.",
    "üåÖ –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, –Ω–æ —ç–ª–µ–∫—Ç—Ä–∏—á–∫–∞ ‚Äî –¥–∞.",
    "üß© –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç ‚Äî –µ—â—ë –æ–¥–∏–Ω –∫—É—Å–æ—á–µ–∫ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–≥–æ –º–∏—Ä–∞.",
    "üéß –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–ª—É—à–∞—Ç—å —Ç–∏—à–∏–Ω—É –Ω–∞ —Ä–µ–ª—å—Å–∞—Ö –º—ã—Å–ª–∏.",
    "üöâ –°–ª–µ–¥—É—é—â–∞—è —Å—Ç–∞–Ω—Ü–∏—è ‚Äî —Å–º—ã—Å–ª. –ù–µ –ø—Ä–æ—Å–ø–∏.",
    "üì° –î—É—à–∞ –ª–æ–≤–∏—Ç Wi-Fi –æ—Ç –í—Å–µ–ª–µ–Ω–Ω–æ–π.",
    "üéà –ü—É—Å—Ç—å –º—ã—Å–ª–∏ –ª–µ—Ç—è—Ç –±—ã—Å—Ç—Ä–µ–µ –ø–æ–µ–∑–¥–æ–≤.",
    "üï∞ –í—Ä–µ–º—è –∏–¥—ë—Ç, –Ω–æ —ç–ª–µ–∫—Ç—Ä–∏—á–∫–∞ –ø–æ–¥–æ–∂–¥—ë—Ç.",
    "üö¶ –ö—Ä–∞—Å–Ω—ã–π ‚Äî —Å—Ç–æ–π. –ó–µ–ª—ë–Ω—ã–π ‚Äî —Ç–≤–æ—Ä–∏.",
    "üõ§ –ú—ã –≤—Å–µ –µ–¥–µ–º –ø–æ —Å–≤–æ–∏–º —Ä–µ–ª—å—Å–∞–º ‚Äî –≤–∞–∂–Ω–æ –Ω–µ —Å–æ—à—ë–ª –ª–∏ —Ç—ã —Å –ø—É—Ç–∏.",
    "üì∑ –ñ–∏–∑–Ω—å ‚Äî –∫–∞–¥—Ä, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ ‚Äî –≤—ã–¥–µ—Ä–∂–∫–∞.",
    "‚öôÔ∏è –ö–∞–∂–¥—ã–π —Å–±–æ–π —Å–∏—Å—Ç–µ–º—ã ‚Äî —à–∞–Ω—Å –æ–±–Ω–æ–≤–∏—Ç—å—Å—è.",
    "üåå –î–∞–∂–µ –∑–≤—ë–∑–¥—ã –∑–Ω–∞—é—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–≤–æ–µ–≥–æ —Å–∏—è–Ω–∏—è.",
    "‚òÅÔ∏è –ú–µ—á—Ç—ã ‚Äî —ç—Ç–æ –æ–±–ª–∞–∫–∞, —ç–ª–µ–∫—Ç—Ä–∏—á–∫–∞ –∏–¥–µ–π –∏–¥—ë—Ç —Å–∫–≤–æ–∑—å –Ω–∏—Ö.",
    "üé¢ –ú—ã—Å–ª–∏ –ø–µ—Ç–ª—è—é—Ç, –∫–∞–∫ —Ä–µ–ª—å—Å—ã –≤ –º–µ—Ç–µ–ª—å.",
    "üçÉ –û—Ç–ø—É—Å—Ç–∏ –≤—Å—ë –Ω–µ–Ω—É–∂–Ω–æ–µ ‚Äî –ø—É—Å—Ç—å —É–ø–∞–¥—ë—Ç –Ω–∞ —à–ø–∞–ª—ã.",
    "üìö –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –±–∏–ª–µ—Ç –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–∞.",
    "üöÄ –ò–Ω–æ–≥–¥–∞, —á—Ç–æ–±—ã –ø–æ–µ—Ö–∞—Ç—å –≤–ø–µ—Ä—ë–¥, –Ω—É–∂–Ω–æ —á—É—Ç—å-—á—É—Ç—å —Å–æ–π—Ç–∏ —Å —Ä–µ–ª—å—Å.",
    "üåï –ù–æ—á—å ‚Äî –Ω–µ —Ç—å–º–∞, –∞ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∏–¥–µ–π.",
    "‚ú® –ò—Å–∫—Ä–∞ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, –Ω–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç.",
    "üåä –ü–æ—Ç–æ–∫ –º—ã—Å–ª–µ–π ‚Äî –Ω–∞—à–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ.",
    "ü™û –í –æ—Ç—Ä–∞–∂–µ–Ω–∏–∏ –æ–∫–Ω–∞ –≤–∏–¥–µ–Ω —Ç—ã ‚Äî –ø–∞—Å—Å–∞–∂–∏—Ä –≤—Ä–µ–º–µ–Ω–∏.",
    "ü™´ –î–∞–∂–µ —Ä–∞–∑—Ä—è–∂–µ–Ω–Ω–∞—è –¥—É—à–∞ –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å —Å–≤–µ—Ç.",
    "üìç –ú—ã –Ω–µ —Ç–µ—Ä—è–µ–º –ø—É—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–µ–º –æ—Å—Ç–∞–Ω–æ–≤–∫—É.",
    "üé° –ò–¥–µ–∏ –∫—Ä—É–∂–∞—Ç—Å—è, –∫–∞–∫ –≤–∞–≥–æ–Ω—ã –≤ –≥–æ–ª–æ–≤–µ.",
    "ü™∂ –õ—ë–≥–∫–æ—Å—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ—Å—Ç–∞—ë—à—å –¥–µ—Ä–∂–∞—Ç—å—Å—è –∑–∞ –ø–æ—Ä—É—á–Ω–∏.",
    "üß≠ –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –Ω–µ –∏—â—É—Ç ‚Äî –Ω–∞ –Ω–µ–≥–æ —Å–∞–¥—è—Ç—Å—è, –∫–∞–∫ –Ω–∞ –ø–æ–µ–∑–¥.",
    "üì¶ –°–∫—É–∫–∞ ‚Äî —ç—Ç–æ –±–∞–≥–∞–∂ –±–µ–∑ —Ä—É—á–∫–∏.",
    "üå† –í –∫–∞–∂–¥–æ–º –ø–æ—Å—Ç–µ ‚Äî –∏—Å–∫—Ä–∞ –æ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ø—Ä–æ–≤–æ–¥–∞.",
    "üí≠ –ú—ã—Å–ª–∏ —Ç–µ–∫—É—Ç –ø–æ —Ä–µ–ª—å—Å–∞–º –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—è.",
    "üéá –ú–∏—Ä ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω—Ü–∏—è –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –∏–¥–µ–π.",
    "üöß –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–≥–æ–Ω, —á—Ç–æ–±—ã –æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—á—Ç—ã.",
    "üìª –í—Å–µ–ª–µ–Ω–Ω–∞—è —à–µ–ø—á–µ—Ç –≤ –¥–∏–Ω–∞–º–∏–∫–∞—Ö —Ç–≤–æ–µ–π –≥–æ–ª–æ–≤—ã.",
    "üßò‚Äç‚ôÇÔ∏è –ü–æ–∫–æ–π ‚Äî —ç—Ç–æ —Ç–æ–∂–µ –¥–≤–∏–∂–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ.",
    "üìñ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤–∞—è —Å—Ç–∞–Ω—Ü–∏—è —Å–º—ã—Å–ª–∞.",
    "üïä –°–≤–æ–±–æ–¥–∞ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –µ–¥–µ—à—å –±–µ–∑ –∫–æ–Ω–µ—á–Ω–æ–π.",
    "üé¨ –ö–∞–∂–¥—ã–π –∫–∞–¥—Ä –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è ‚Äî –±–∏–ª–µ—Ç –≤ –≤–µ—á–Ω–æ—Å—Ç—å.",
    "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ ‚Äî –≥—Ä–∞—Ñ–∏–∫ –±–µ–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.",
    "üö¥ –î–∞–∂–µ —Å—Ç–æ—è –Ω–∞ –º–µ—Å—Ç–µ, –º–æ–∂–Ω–æ –µ—Ö–∞—Ç—å –≤–Ω—É—Ç—Ä–∏.",
    "‚ö° –ò—Å–∫—Ä–∞ –∫ –∏—Å–∫—Ä–µ ‚Äî –∏ —É–∂–µ —Å–≤–µ—Ç–ª–æ.",
    "ü™Ñ –ò–¥–µ–∏ –Ω–µ –∏—Å—á–µ–∑–∞—é—Ç ‚Äî –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å–∞–∂–∏–≤–∞—é—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π –º–∞—Ä—à—Ä—É—Ç.",
    "üé∞ –ñ–∏–∑–Ω—å ‚Äî —ç—Ç–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.",
    "üå§ –ò–Ω–æ–≥–¥–∞ –ª—É—á—à–µ –æ–ø–æ–∑–¥–∞—Ç—å, —á–µ–º —É–µ—Ö–∞—Ç—å –Ω–µ —Ç—É–¥–∞.",
    "üß§ –ù–µ –±–æ–π—Å—è —Ö–æ–ª–æ–¥–Ω—ã—Ö –¥–Ω–µ–π ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –≥—Ä–µ–µ—Ç.",
    "üõû –ö–æ–ª—ë—Å–∞ —Å—É–¥—å–±—ã –≤—Å–µ–≥–¥–∞ –ø–æ —Ä–µ–ª—å—Å–∞–º –≤—ã–±–æ—Ä–∞.",
    "üéí –ö–∞–∂–¥—ã–π –æ–ø—ã—Ç ‚Äî –±–∞–≥–∞–∂ –∏–¥–µ–π.",
    "ü™ô –¶–µ–Ω–Ω–æ—Å—Ç—å –º—ã—Å–ª–∏ ‚Äî –≤ –ø—É—Ç–∏, –∞ –Ω–µ –≤ –ø—É–Ω–∫—Ç–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.",
    "üß† –ú–æ–∑–≥ –∫–∞–∫ –¥–≤–∏–≥–∞—Ç–µ–ª—å: –∏–Ω–æ–≥–¥–∞ –≥—Ä–µ–µ—Ç—Å—è, –Ω–æ –µ–¥–µ—Ç.",
    "üé¢ –ñ–∏–∑–Ω—å ‚Äî —ç—Ç–æ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω —Å –ø–µ—Ä–µ—Å–∞–¥–∫–∞–º–∏.",
    "üïπ –£–ø—Ä–∞–≤–ª—è–π —Å–≤–æ–∏–º –º–∞—Ä—à—Ä—É—Ç–æ–º.",
    "üé∂ –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç ‚Äî —ç—Ç–æ –º—É–∑—ã–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π —Å–µ—Ç–∏.",
    "üöã –ò–¥–µ–∏ –µ–¥—É—Ç —Ç—Ä–∞–º–≤–∞–µ–º —Å–æ–∑–Ω–∞–Ω–∏—è.",
    "üïØ –î–∞–∂–µ –æ–¥–Ω–∞ –º—ã—Å–ª—å —Å–ø–æ—Å–æ–±–Ω–∞ –æ—Å–≤–µ—Ç–∏—Ç—å —Ç–æ–Ω–Ω–µ–ª—å.",
    "üßµ –ú—ã—Å–ª–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ–≤–æ–¥–∞ –º–µ–∂–¥—É —Å–µ—Ä–¥—Ü–µ–º –∏ —Ä–∞–∑—É–º–æ–º.",
    "ü™¥ –†–∞—Å—Ç—É—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ç–µ–Ω–∏—è ‚Äî —Ä–∞—Å—Ç—É—Ç –∏–¥–µ–∏.",
    "üõ† –ò—Å–ø—Ä–∞–≤—å —à–ø–∞–ª—É ‚Äî –∏ –ø—É—Ç—å —Å—Ç–∞–Ω–µ—Ç —Ä–æ–≤–Ω—ã–º.",
    "üì∏ –ú–æ–º–µ–Ω—Ç –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è ‚Äî –Ω–µ —É–ª–æ–≤–∏, –ø–æ—á—É–≤—Å—Ç–≤—É–π.",
    "üìû –£—Å–ª—ã—à—å –∑–≤–æ–Ω–æ–∫ —Å—É–¥—å–±—ã ‚Äî —Ç–≤–æ–π –ø–æ–µ–∑–¥ –ø—Ä–∏–±—ã–ª.",
    "üßä –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∑–∞–º–µ—Ä–µ—Ç—å, —á—Ç–æ–±—ã —Ä–∞—Å—Ç–æ–ø–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–∞—Ö–∏.",
    "ü™Å –í–µ—Ç–µ—Ä –ø–µ—Ä–µ–º–µ–Ω –¥—É–µ—Ç –≤ –æ–∫–Ω–æ –∫—É–ø–µ –¥—É—à–∏.",
    "üö® –°–≤–µ—Ç–æ—Ñ–æ—Ä –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –º–∏–≥–∞–µ—Ç –∂—ë–ª—Ç—ã–º.",
    "üß≤ –ü—Ä–∏—Ç—è–≥–∏–≤–∞–π —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ.",
    "üéÅ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤—ã–π –≤–∞–≥–æ–Ω –ø–æ–¥–∞—Ä–∫–æ–≤.",
    "üß≥ –ß–µ–º –º–µ–Ω—å—à–µ –±–∞–≥–∞–∂–∞, —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ —ç–ª–µ–∫—Ç—Ä–∏—á–∫–∞.",
    "üö™ –ù–æ–≤—ã–µ –∏–¥–µ–∏ –Ω–µ –≤—Ö–æ–¥—è—Ç –≤ –∑–∞–∫—Ä—ã—Ç—ã–µ –¥–≤–µ—Ä–∏.",
    "üîã –ó–∞—Ä—è–∂–∞–π—Å—è –æ—Ç –º–µ–ª–æ—á–µ–π.",
    "üí´ –ú—ã—Å–ª–∏ ‚Äî –∫–∞–∫ –∏—Å–∫—Ä—ã, –Ω–µ –¥–∞–π –∏–º –ø–æ–≥–∞—Å–Ω—É—Ç—å.",
    "üìÜ –í—á–µ—Ä–∞ –±—ã–ª —á–µ—Ä–Ω–æ–≤–∏–∫, —Å–µ–≥–æ–¥–Ω—è ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è.",
    "üß© –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –∫—É—Å–æ—á–µ–∫ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–∞–∑–ª–∞.",
    "üöø –°–º–æ–π —É—Å—Ç–∞–ª–æ—Å—Ç—å, –æ—Å—Ç–∞–≤—å —Ç–æ–ª—å–∫–æ —Å–≤–µ—Ç.",
    "üèÅ –ù–µ –≤–∞–∂–Ω–æ, –≥–¥–µ –∫–æ–Ω–µ—Ü –ø—É—Ç–∏ ‚Äî –≤–∞–∂–Ω–æ, —á—Ç–æ —Ç—ã –≤ –ø—É—Ç–∏.",
    "üé† –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ ‚Äî –∫—Ä—É–≥–æ–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ.",
    "üéó –î–∞–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ ‚Äî —á–∞—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–∞.",
    "üéØ –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ —Ç–æ—á–Ω–æ –ø–æ–ø–∞–¥—ë—Ç –≤ —Ü–µ–ª—å, –µ—Å–ª–∏ –¥–∞—Ç—å –µ–º—É —à–∞–Ω—Å.",
    "üéè –ü—É—Å—Ç—å –≤–µ—Ç–µ—Ä –Ω–µ—Å—ë—Ç —Ç–≤–æ–∏ –∏–¥–µ–∏ –¥–∞–ª—å—à–µ —Å—Ç–∞–Ω—Ü–∏–∏.",
    "üéª –î—É—à–∞ –∑–≤—É—á–∏—Ç, –∫–æ–≥–¥–∞ —Ç—ã –Ω–∞ —Å–≤–æ–µ–π —á–∞—Å—Ç–æ—Ç–µ.",
    "üé∫ –ú—É–∑—ã–∫–∞ –º—ã—Å–ª–µ–π –≥—Ä–æ–º—á–µ —à—É–º–∞ –º–∏—Ä–∞.",
    "üö≤ –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–ø–ª–∏–≤–∞, —Ç–æ–ª—å–∫–æ –¥–≤–∏–∂–µ–Ω–∏—è.",
    "üõ∏ –ò–Ω–æ–≥–¥–∞ –∏–¥–µ–∏ –ø—Ä–∏–ª–µ—Ç–∞—é—Ç –Ω–µ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.",
    "üìØ –£—Å–ª—ã—à—å —Å–∏–≥–Ω–∞–ª ‚Äî –ø–æ—Ä–∞ –≤ –ø—É—Ç—å.",
    "ü™∂ –ü—É—Å—Ç—å –ª—ë–≥–∫–æ—Å—Ç—å —Å—Ç–∞–Ω–µ—Ç –º–∞—Ä—à—Ä—É—Ç–æ–º.",
    "üïä –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –±–∏–ª–µ—Ç –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–∞."
]

HASHTAGS = ["#—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è", "#—é–º–æ—Ä", "#—Ü–∏—Ç–∞—Ç–∞", "#–º–æ—Ç–∏–≤–∞—Ü–∏—è", "#–º—ã—Å–ª–∏"]
CATEGORIES = ["–∂–∏–∑–Ω—å", "—Å—á–∞—Å—Ç—å–µ", "–º–æ—Ç–∏–≤–∞—Ü–∏—è", "—é–º–æ—Ä", "—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è"]
LOGO_PATH = "logo.png"

# ------------------- –§—É–Ω–∫—Ü–∏–∏ -------------------
def get_quote():
    try:
        res = requests.get("https://zenquotes.io/api/random", timeout=10)
        res.raise_for_status()
        data = res.json()[0]
        return data.get('q', '–¶–∏—Ç–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞'), data.get('a', '')
    except Exception as e:
        print(f"[ERROR] –¶–∏—Ç–∞—Ç–∞: {e}", flush=True)
        return "–¶–∏—Ç–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞", ""

def translate_quote(text):
    try:
        return GoogleTranslator(source='en', target='ru').translate(text)
    except Exception as e:
        print(f"[ERROR] –ü–µ—Ä–µ–≤–æ–¥: {e}", flush=True)
        return text

def get_image():
    try:
        url = f"https://picsum.photos/800/600?random={int(time.time())}"
        img_bytes = requests.get(url, timeout=10).content
        image = Image.open(BytesIO(img_bytes)).convert("RGBA")
        return overlay_logo(image)
    except Exception as e:
        print(f"[ERROR] –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {e}", flush=True)
        return None

def overlay_logo(image):
    try:
        if not os.path.exists(LOGO_PATH):
            output = BytesIO()
            image.save(output, format="PNG")
            output.seek(0)
            return output
        logo = Image.open(LOGO_PATH).convert("RGBA")
        base_width = int(image.width * 0.15)
        h_size = int((base_width / logo.width) * logo.height)
        logo = logo.resize((base_width, h_size), Image.LANCZOS)
        pos = (image.width - logo.width - 10, image.height - logo.height - 10)
        image.paste(logo, pos, logo)
        output = BytesIO()
        image.save(output, format="PNG")
        output.seek(0)
        return output
    except Exception as e:
        print(f"[ERROR] –õ–æ–≥–æ—Ç–∏–ø: {e}", flush=True)
        output = BytesIO()
        image.save(output, format="PNG")
        output.seek(0)
        return output

def send_post(quote, author, image_bytes):
    if not image_bytes or image_bytes.getbuffer().nbytes == 0:
        print("[WARN] –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏", flush=True)
        return

    try:
        url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendPhoto"
        firma = random.choice(FIRMA_SIGNATURES)
        text = f"[{random.choice(CATEGORIES).upper()}] {quote}\n‚Äî {author}\n{firma}\n{' '.join(random.sample(HASHTAGS, 2))}"
        resp = requests.post(
            url,
            data={"chat_id": TELEGRAM_CHAT_ID, "caption": text},
            files={"photo": ("post.png", image_bytes, "image/png")},
            timeout=15
        )
        if resp.status_code == 200:
            print("[‚úÖ] –ü–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ", flush=True)
        else:
            print(f"[‚ùå] –û—à–∏–±–∫–∞ Telegram: {resp.status_code} {resp.text}", flush=True)
    except Exception as e:
        print(f"[‚ùå] –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: {e}", flush=True)

def job_post():
    print("[üîÑ] –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏ –ø–æ—Å—Ç–∏–Ω–≥–∞...", flush=True)
    quote, author = get_quote()
    quote_ru = translate_quote(quote)
    image = get_image()
    if image is None:
        print("[WARN] –ü—Ä–æ–ø—É—Å–∫ –ø–æ—Å—Ç–∞: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ", flush=True)
        return
    send_post(f"{quote} ({quote_ru})", author, image)

# ------------------- Flask —Å–µ—Ä–≤–µ—Ä –∏ Webhook -------------------
app = Flask(__name__)

@app.route('/')
def home():
    return "üöÜ –≠–ª–µ–∫—Ç—Ä–∏—á–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç."

@app.route('/webhook', methods=['POST'])
def telegram_webhook():
    update = request.get_json()
    if not update or "message" not in update:
        return jsonify({"ok": True})

    message = update["message"]
    chat_id = str(message["chat"]["id"])
    text = message.get("text", "").strip()

    # –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å
    if not ADMIN_CHAT_ID or chat_id != ADMIN_CHAT_ID:
        return jsonify({"ok": True})

    if text == "/post_now":
        Thread(target=job_post).start()
        requests.post(
            f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage",
            json={"chat_id": chat_id, "text": "‚úÖ –ü–æ—Å—Ç –∑–∞–ø—É—â–µ–Ω!"}
        )
    elif text == "/status":
        requests.post(
            f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage",
            json={"chat_id": chat_id, "text": "üü¢ –≠–ª–µ–∫—Ç—Ä–∏—á–∫–∞ –≤ –ø—É—Ç–∏!"}
        )
    return jsonify({"ok": True})

def run_flask():
    port = int(os.getenv("PORT", 10000))
    app.run(host="0.0.0.0", port=port)

# –ó–∞–ø—É—Å–∫ Flask –≤ —Ñ–æ–Ω–µ
Thread(target=run_flask, daemon=True).start()

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook
def set_webhook():
    WEBHOOK_URL = os.getenv("WEBHOOK_URL")
    if not WEBHOOK_URL:
        print("[WARN] WEBHOOK_URL –Ω–µ –∑–∞–¥–∞–Ω ‚Äî –∫–æ–º–∞–Ω–¥—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã", flush=True)
        return
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/setWebhook"
    resp = requests.post(url, json={"url": f"{WEBHOOK_URL}/webhook"})
    print(f"[INFO] Webhook response: {resp.json()}", flush=True)

set_webhook()

# ------------------- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ -------------------
schedule.every(3).hours.do(job_post)

def run_scheduler():
    print("[‚è∞] –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω: –ø–æ—Å—Ç –∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞", flush=True)
    while True:
        schedule.run_pending()
        time.sleep(30)

Thread(target=run_scheduler, daemon=True).start()

# ------------------- –ü–µ—Ä–≤—ã–π –ø–æ—Å—Ç —Å—Ä–∞–∑—É -------------------
print("[üöÄ] –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å—Ç–∞...", flush=True)
job_post()

# ------------------- –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª -------------------
print("[üü¢] –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç. –ñ–¥—ë–º –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é...", flush=True)
while True:
    time.sleep(60)
